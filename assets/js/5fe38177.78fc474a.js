"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[8250],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),d=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=d(n),u=a,h=m["".concat(l,".").concat(u)]||m[u]||p[u]||s;return n?r.createElement(h,i(i({ref:t},c),{},{components:n})):r.createElement(h,i({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var d=2;d<s;d++)i[d]=n[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(7294),a=n(6010);const s="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(s,i),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>P});var r=n(7462),a=n(7294),s=n(6010),i=n(2466),o=n(6775),l=n(1980),d=n(7392),c=n(12);function p(e){return function(e){var t;return(null==(t=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function m(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,d.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function u(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const r=(0,o.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=m(e),[i,o]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!u({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[l,d]=h({queryString:n,groupId:r}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,c.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:r}),y=(()=>{const e=l??p;return u({value:e,tabValues:s})?e:null})();(0,a.useLayoutEffect)((()=>{y&&o(y)}),[y]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!u({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),f(e)}),[d,f,s]),tabValues:s}}var y=n(2389);const k="tabList__CuJ",v="tabItem_LNqP";function b(e){let{className:t,block:n,selectedValue:o,selectValue:l,tabValues:d}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),m=e=>{const t=e.currentTarget,n=c.indexOf(t),r=d[n].value;r!==o&&(p(t),l(r))},u=e=>{var t;let n=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}null==(t=n)||t.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},t)},d.map((e=>{let{value:t,label:n,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>c.push(e),onKeyDown:u,onClick:m},i,{className:(0,s.Z)("tabs__item",v,null==i?void 0:i.className,{"tabs__item--active":o===t})}),n??t)})))}function g(e){let{lazy:t,children:n,selectedValue:r}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function w(e){const t=f(e);return a.createElement("div",{className:(0,s.Z)("tabs-container",k)},a.createElement(b,(0,r.Z)({},e,t)),a.createElement(g,(0,r.Z)({},e,t)))}function P(e){const t=(0,y.Z)();return a.createElement(w,(0,r.Z)({key:String(t)},e))}},3721:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>p});var r=n(7462),a=(n(7294),n(3905)),s=n(4866),i=n(5162);const o={sidebar_label:"Grant Permissions to 3rd parties",sidebar_position:1},l="Grant Permissions to 3rd party addresses",d={unversionedId:"guides/key-manager/give-permissions",id:"guides/key-manager/give-permissions",title:"Grant Permissions to 3rd party addresses",description:"You will need a Universal Profile that you can control via its KeyManager to follow this guide.",source:"@site/docs/guides/key-manager/give-permissions.md",sourceDirName:"guides/key-manager",slug:"/guides/key-manager/give-permissions",permalink:"/guides/key-manager/give-permissions",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/key-manager/give-permissions.md",tags:[],version:"current",lastUpdatedAt:1681475070,formattedLastUpdatedAt:"Apr 14, 2023",sidebarPosition:1,frontMatter:{sidebar_label:"Grant Permissions to 3rd parties",sidebar_position:1},sidebar:"guidesSidebar",previous:{title:"Sign arbitrary messages",permalink:"/guides/browser-extension/sign-arbitrary-messages"},next:{title:"Get controller addresses",permalink:"/guides/key-manager/get-controllers"}},c={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Setup",id:"setup",level:2},{value:"Step 1 - Initialize erc725.js",id:"step-1---initialize-erc725js",level:2},{value:"Step 2 - Encode the permissions",id:"step-2---encode-the-permissions",level:2},{value:"2.1 - Create the permission",id:"21---create-the-permission",level:3},{value:"2.2 - Encode the permission for the 3rd party address",id:"22---encode-the-permission-for-the-3rd-party-address",level:3},{value:"Step 3 - Add the permissions on your UP",id:"step-3---add-the-permissions-on-your-up",level:2},{value:"3.1 - Add imports &amp; constants",id:"31---add-imports--constants",level:3},{value:"3.2 - Load your controller address",id:"32---load-your-controller-address",level:3},{value:"3.3 - Create contract instance",id:"33---create-contract-instance",level:3},{value:"3.4 - Set the permission on the Universal Profile",id:"34---set-the-permission-on-the-universal-profile",level:3},{value:"Final code",id:"final-code",level:2},{value:"Testing the permissions",id:"testing-the-permissions",level:2}],m={toc:p};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"grant-permissions-to-3rd-party-addresses"},"Grant Permissions to 3rd party addresses"),(0,a.kt)("admonition",{title:"Requirements",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"You will need a Universal Profile that you can control via its KeyManager to follow this guide. ",(0,a.kt)("br",null),"\nIf you don't have a Universal Profile yet, follow our previous guide ",(0,a.kt)("a",{parentName:"p",href:"/guides/universal-profile/create-profile"},(0,a.kt)("strong",{parentName:"a"},"Create a Universal Profile"))," or look at the ",(0,a.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/universal-profile"},(0,a.kt)("em",{parentName:"a"},"lsp-factory.js"))," docs.")),(0,a.kt)("p",null,"In this guide, we will learn how to grant permissions to third-party addresses to enable them to interact with our Universal Profile."),(0,a.kt)("p",null,"By the end of this guide, you will know:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"How permissions in the LSP6 Key Manager work + how to create them using ",(0,a.kt)("a",{parentName:"li",href:"../../../../tools/erc725js/getting-started"},(0,a.kt)("em",{parentName:"a"},"erc725.js")),"."),(0,a.kt)("li",{parentName:"ul"},"How to set permissions for a third party ",(0,a.kt)("inlineCode",{parentName:"li"},"address")," on your Universal Profile.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Give permissions to 3rd parties overview",src:n(6491).Z,width:"1984",height:"2015"})),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"The Key Manager (KM) enables us to give permissions to other 3rd party addresses to perform certain actions on our Universal Profile (UP), such as editing our profile details, or any other profile metadata."),(0,a.kt)("p",null,"When granting permissions to a new address, we need to update three data keys in the ",(0,a.kt)("a",{parentName:"p",href:"/standards/lsp-background/erc725#erc725y"},"ERC725Y")," storage of our Universal Profile:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"\ud83d\uddc4\ufe0f ERC725Y data key"),(0,a.kt)("th",{parentName:"tr",align:null},"\ud83d\udcc3 Description"),(0,a.kt)("th",{parentName:"tr",align:null},"\ud83c\udfaf ",(0,a.kt)("strong",{parentName:"th"},"Objective")))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"/standards/universal-profile/lsp6-key-manager#retrieving-addresses-with-permissions"},(0,a.kt)("inlineCode",{parentName:"a"},"AddressPermissions[]"))),(0,a.kt)("td",{parentName:"tr",align:null},"holds the number of addresses that have permissions on our UP."),(0,a.kt)("td",{parentName:"tr",align:null},"We need to ",(0,a.kt)("strong",{parentName:"td"},"increment it by +1"),".")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"/standards/universal-profile/lsp6-key-manager#retrieving-addresses-with-permissions"},(0,a.kt)("inlineCode",{parentName:"a"},"AddressPermissions[index]"))),(0,a.kt)("td",{parentName:"tr",align:null},"holds a controller address at a specific index."),(0,a.kt)("td",{parentName:"tr",align:null},"We need to ",(0,a.kt)("strong",{parentName:"td"},"add the beneficiary address at the new index"),".")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"/standards/universal-profile/lsp6-key-manager#address-permissions"},(0,a.kt)("inlineCode",{parentName:"a"},"AddressPermissions:Permissions:<beneficiary-address>"))),(0,a.kt)("td",{parentName:"tr",align:null},"this data key holds the permissions of a controller address."),(0,a.kt)("td",{parentName:"tr",align:null},"We need to ",(0,a.kt)("strong",{parentName:"td"},"add the permissions of the beneficiary address")," under this data key.")))),(0,a.kt)("h2",{id:"setup"},"Setup"),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install web3 @erc725/erc725.js @lukso/lsp-smart-contracts\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install ethers @erc725/erc725.js @lukso/lsp-smart-contracts\n")))),(0,a.kt)("h2",{id:"step-1---initialize-erc725js"},"Step 1 - Initialize erc725.js"),(0,a.kt)("p",null,"The first step is to initialize the erc725.js library with a JSON schema specific to the LSP6 Key Manager. This will enable the library to know how to create and encode the permissions."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ERC725 } from '@erc725/erc725.js';\nimport LSP6Schema from '@erc725/erc725.js/schemas/LSP6KeyManager.json';\n\n// step 1 -initialize erc725.js with the ERC725Y permissions data keys from LSP6 Key Manager\nconst erc725 = new ERC725(\n  LSP6Schema,\n  myUniversalProfileAddress,\n  web3.currentProvider,\n);\n")),(0,a.kt)("h2",{id:"step-2---encode-the-permissions"},"Step 2 - Encode the permissions"),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"More permissions are available in erc725.js. See the API docs for ",(0,a.kt)("a",{parentName:"p",href:"/tools/erc725js/classes/ERC725#encodepermissions"},(0,a.kt)("inlineCode",{parentName:"a"},"encodePermissions(...)"))," function for a complete list.")),(0,a.kt)("p",null,"We can now use erc725.js to create the permissions for a specific 3rd party ",(0,a.kt)("inlineCode",{parentName:"p"},"address"),". The library provide convenience functions for us, such as ",(0,a.kt)("a",{parentName:"p",href:"../../../../tools/erc725js/classes/ERC725#encodepermissions"},(0,a.kt)("inlineCode",{parentName:"a"},"encodePermissions")),"."),(0,a.kt)("h3",{id:"21---create-the-permission"},"2.1 - Create the permission"),(0,a.kt)("p",null,"Let's consider in our example that we want to grant the permission ",(0,a.kt)("inlineCode",{parentName:"p"},"SETDATA")," to a ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),", so that it can edit our Universal Profile details on our behalf."),(0,a.kt)("p",null,"We can do this very easily with erc725.js, using the ",(0,a.kt)("inlineCode",{parentName:"p"},"encodePermissions(...)")," function."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 2.1 - create the permissions of the beneficiary address\nconst beneficiaryPermissions = erc725.encodePermissions({\n  SETDATA: true,\n});\n")),(0,a.kt)("h3",{id:"22---encode-the-permission-for-the-3rd-party-address"},"2.2 - Encode the permission for the 3rd party address"),(0,a.kt)("p",null,"Now that we have created the permission value ",(0,a.kt)("inlineCode",{parentName:"p"},"SETDATA"),", we need to assign it to the ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),"."),(0,a.kt)("p",null,"To do so, we need to assign the permission value created in step 2.1 to the ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),", using the ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions:Permissions:<address>"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"<address>")," will be the address of the beneficiary."),(0,a.kt)("p",null,"We also need to add the ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions[]")," Array, and increment the ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions[]")," array length (+1)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 2.2 - encode the data key-value pairs of the permissions to be set for the beneficiary address\nconst beneficiaryAddress = '0xcafecafecafecafecafecafecafecafecafecafe'; // EOA address of an exemplary person\n\nconst addressPermissionsArray = await erc725.getData('AddressPermissions[]');\nconst controllers = addressPermissionsArray.value;\n\nconst permissionData = erc725.encodeData([\n  // the permission of the beneficiary address\n  {\n    keyName: 'AddressPermissions:Permissions:<address>',\n    dynamicKeyParts: beneficiaryAddress,\n    value: beneficiaryPermissions,\n  },\n  // the new list controllers addresses (= addresses with permissions set on the UP)\n  // + the incremented `AddressPermissions[]` array length\n  {\n    keyName: 'AddressPermissions[]',\n    value: [...controllers, beneficiaryAddress],\n  },\n]);\n")),(0,a.kt)("h2",{id:"step-3---add-the-permissions-on-your-up"},"Step 3 - Add the permissions on your UP"),(0,a.kt)("p",null,"We have now all the data needed to setup the permission for this 3rd party addres on our Universal Profile."),(0,a.kt)("h3",{id:"31---add-imports--constants"},"3.1 - Add imports & constants"),(0,a.kt)("p",null,"To get started you would need the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"UniversalProfile")," from ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-smart-contracts"},(0,a.kt)("inlineCode",{parentName:"a"},"@lukso/lsp-smart-contracts"))," in order to use its ABI."),(0,a.kt)("li",{parentName:"ul"},"The private key for your ",(0,a.kt)("em",{parentName:"li"},"controller address")," with proper ",(0,a.kt)("a",{parentName:"li",href:"/standards/universal-profile/lsp6-key-manager#permissions"},(0,a.kt)("strong",{parentName:"a"},"permissions")),", used for interacting with the Universal Profile."),(0,a.kt)("li",{parentName:"ul"},"The address of the Universal Profile that you want to interact with.")),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Load account from a private key"',title:'"Load',account:!0,from:!0,a:!0,private:!0,'key"':!0},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport Web3 from 'web3';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\nconst myUniversalProfileAddress = '0x...';\nconst PRIVATE_KEY = '0x...'; // your EOA private key (previously created)\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Load account from a private key"',title:'"Load',account:!0,from:!0,a:!0,private:!0,'key"':!0},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport { ethers } from 'ethers';\n\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\nconst myUniversalProfileAddress = '0x...';\nconst PRIVATE_KEY = '0x...'; // your EOA private key (previously created)\n")))),(0,a.kt)("h3",{id:"32---load-your-controller-address"},"3.2 - Load your controller address"),(0,a.kt)("p",null,"We will need to interact with the Key Manager from the main controller address (the externally owned account (EOA) that has all the permissions on the UP)."),(0,a.kt)("p",null,"The first step is to load this main controller address as an EOA using its private key."),(0,a.kt)("p",null,"The private key can be obtained depending on how you created your Universal Profile:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"UP created with our ",(0,a.kt)("strong",{parentName:"li"},"Create a Universal Profile guide"),": you should have provided the private key and known it."),(0,a.kt)("li",{parentName:"ul"},"UP created with the ",(0,a.kt)("em",{parentName:"li"},"lsp-factory.js"),": this is the private key given in the ",(0,a.kt)("inlineCode",{parentName:"li"},"controllerAddresses")," field in the method ",(0,a.kt)("a",{parentName:"li",href:"../../tools/lsp-factoryjs/classes/universal-profile#deploy"},(0,a.kt)("inlineCode",{parentName:"a"},"lspFactory.UniversalProfile.deploy(...)"))),(0,a.kt)("li",{parentName:"ul"},"UP created via the Browser extension: click on the ",(0,a.kt)("em",{parentName:"li"},"Settings")," icon (top right) > and ",(0,a.kt)("em",{parentName:"li"},"Export Private Key"))),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Load account from a private key"',title:'"Load',account:!0,from:!0,a:!0,private:!0,'key"':!0},"const myEOA = web3.eth.accounts.wallet.add(PRIVATE_KEY);\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Load account from a private key"',title:'"Load',account:!0,from:!0,a:!0,private:!0,'key"':!0},"const myEOA = new ethers.Wallet(privateKey).connect(provider);\n")))),(0,a.kt)("h3",{id:"33---create-contract-instance"},"3.3 - Create contract instance"),(0,a.kt)("p",null,"The next steps is to create an instance of our UP smart contract to interact with. The contract ABIs are available in the ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@lukso/lsp-smart-contracts"},(0,a.kt)("inlineCode",{parentName:"a"},"@lukso/lsp-smart-contracts"))," npm package."),(0,a.kt)("p",null,"You will need the address of your Universal Profile."),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 1 - create instance of UniversalProfile contract\nconst myUniversalProfile = new web3.eth.Contract(\n  UniversalProfile.abi,\n  myUniversalProfileAddress,\n);\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 1 - create instance of UniversalProfile contract\nconst universalProfile = new ethers.Contract(\n  universalProfileAddress,\n  UniversalProfile.abi,\n);\n")))),(0,a.kt)("h3",{id:"34---set-the-permission-on-the-universal-profile"},"3.4 - Set the permission on the Universal Profile"),(0,a.kt)("p",null,"The last and final step is to setup the permissions the ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," on our Universal Profile."),(0,a.kt)("p",null,"We can easily access the data key-value pair from the encoded data obtained by erc725.js in step 2.2."),(0,a.kt)("p",null,"We will then encode this permission data keys in a ",(0,a.kt)("inlineCode",{parentName:"p"},"setData(...)")," payload and interact via the Key Manager."),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 3.3 - send the transaction\nawait myUniversalProfile.methods['setData(bytes32[],bytes[])'](\n  data.keys,\n  data.values,\n).send({\n  from: myEOA.address,\n  gasLimit: 300_000,\n});\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// step 3.3 - send the transaction\nawait myUniversalProfile\n  .connect(account)\n  ['setData(bytes32[],bytes[])'](data.keys, data.values);\n")))),(0,a.kt)("h2",{id:"final-code"},"Final code"),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport { ERC725 } from '@erc725/erc725.js';\nimport LSP6Schema from '@erc725/erc725.js/schemas/LSP6KeyManager.json';\nimport Web3 from 'web3';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\nconst myUniversalProfileAddress = '0x...';\n\nconst PRIVATE_KEY = '0x...'; // your EOA private key (previously created)\nconst myEOA = web3.eth.accounts.wallet.add(PRIVATE_KEY);\n\nconst erc725 = new ERC725(\n  LSP6Schema,\n  myUniversalProfileAddress,\n  web3.currentProvider,\n);\n\nasync function grantPermissions() {\n  // step 1 - create instance of UP contract\n  const myUniversalProfile = new web3.eth.Contract(\n    UniversalProfile.abi,\n    myUniversalProfileAddress,\n  );\n\n  // step 2 - setup the permissions of the beneficiary address\n  const beneficiaryAddress = '0xcafecafecafecafecafecafecafecafecafecafe'; // EOA address of an exemplary person\n  const beneficiaryPermissions = erc725.encodePermissions({\n    SETDATA: true,\n  });\n\n  // step 3.1 - encode the data key-value pairs of the permissions to be set\n  const addressPermissionsArray = await erc725.getData('AddressPermissions[]');\n  const controllers = addressPermissionsArray.value;\n\n  const data = erc725.encodeData([\n    // the permission of the beneficiary address\n    {\n      keyName: 'AddressPermissions:Permissions:<address>',\n      dynamicKeyParts: beneficiaryAddress,\n      value: beneficiaryPermissions,\n    },\n    // the new list controllers addresses (= addresses with permissions set on the UP)\n    // + the incremented `AddressPermissions[]` array length\n    {\n      keyName: 'AddressPermissions[]',\n      value: [...controllers, beneficiaryAddress],\n    },\n  ]);\n\n  // step 3.3 - send the transaction\n  await myUniversalProfile.methods['setData(bytes32[],bytes[])'](\n    data.keys,\n    data.values,\n  ).send({\n    from: myEOA.address,\n    gasLimit: 300_000,\n  });\n\n  const result = await myUniversalProfile.methods['getData(bytes32)'](\n    data.keys[0],\n  ).call();\n  console.log(\n    `The beneficiary address ${beneficiaryAddress} has now the following permissions:`,\n    erc725.decodePermissions(result),\n  );\n}\n\ngrantPermissions();\n"))),(0,a.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport { ERC725 } from '@erc725/erc725.js';\nimport LSP6Schema from '@erc725/erc725.js/schemas/LSP6KeyManager.json';\nimport { ethers } from 'ethers';\nimport Web3 from 'web3';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\nconst myUniversalProfileAddress = '0x...';\n\nconst PRIVATE_KEY = '0x...'; // your EOA private key (previously created)\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\nconst myEOA = new ethers.Wallet(privateKey).connect(provider);\n\nconst erc725 = new ERC725(\n  LSP6Schema,\n  myUniversalProfileAddress,\n  web3.currentProvider,\n);\n\nasync function grantPermissions() {\n  // step 1 - create instance of UniversalProfile contract\n  const universalProfile = new ethers.Contract(\n    universalProfileAddress,\n    UniversalProfile.abi,\n  );\n\n  // step 2 - setup the permissions of the beneficiary address\n  const beneficiaryAddress = '0xcafecafecafecafecafecafecafecafecafecafe'; // EOA address of an exemplary person\n  const beneficiaryPermissions = erc725.encodePermissions({\n    SETDATA: true,\n  });\n\n  // step 3.1 - encode the data key-value pairs of the permissions to be set\n  const addressPermissionsArray = await erc725.getData('AddressPermissions[]');\n  const controllers = addressPermissionsArray.value;\n\n  const data = erc725.encodeData([\n    // the permission of the beneficiary address\n    {\n      keyName: 'AddressPermissions:Permissions:<address>',\n      dynamicKeyParts: beneficiaryAddress,\n      value: beneficiaryPermissions,\n    },\n    // the new list controllers addresses (= addresses with permissions set on the UP)\n    // + the incremented `AddressPermissions[]` array length\n    {\n      keyName: 'AddressPermissions[]',\n      value: [...controllers, beneficiaryAddress],\n    },\n  ]);\n\n  // step 3.3 - send the transaction\n  await myUniversalProfile\n    .connect(account)\n    ['setData(bytes32[],bytes[])'](data.keys, data.values);\n\n  const result = await myUniversalProfile.['getData(bytes32)'](\n    data.keys[0],\n  );\n  console.log(\n    `The beneficiary address ${beneficiaryAddress} has now the following permissions:`,\n    erc725.decodePermissions(result),\n  );\n}\n\ngrantPermissions();\n")))),(0,a.kt)("h2",{id:"testing-the-permissions"},"Testing the permissions"),(0,a.kt)("p",null,"We can now check that the permissions have been correctly set by querying the ",(0,a.kt)("inlineCode",{parentName:"p"},"AddressPermissions:Permissions:<beneficiaryAddress>")," data key on the ERC725Y storage of the Universal Profile."),(0,a.kt)("p",null,"If everything went well, the code snippet below should return you back an object with the permission ",(0,a.kt)("inlineCode",{parentName:"p"},"SETDATA")," set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const result = await myUniversalProfile.methods['getData(bytes32)'](\n  data.keys[0],\n).call();\nconsole.log(\n  `The beneficiary address ${beneficiaryAddress} has now the following permissions:`,\n  erc725.decodePermissions(result),\n);\n")),(0,a.kt)("p",null,"Finally, to test the actual permissions, you can do this guide using a ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," that you have control over (created manually via web3.js)."),(0,a.kt)("p",null,"You can then try to do again the ",(0,a.kt)("strong",{parentName:"p"},"Edit our Universal Profile")," guide, using this new 3rd party address that you have control over to test if it can successfull edit the profile details. This will give you guarantee that this ",(0,a.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," has the ",(0,a.kt)("inlineCode",{parentName:"p"},"SETDATA")," permission working."))}u.isMDXComponent=!0},6491:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/grant-permissions-to-3rd-parties-overview-c4946b76bf11d118d717f847c18f9449.jpeg"}}]);