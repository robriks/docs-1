"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[7807],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),c=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(a),m=r,f=d["".concat(i,".").concat(m)]||d[m]||p[m]||s;return a?n.createElement(f,l(l({ref:t},u),{},{components:a})):n.createElement(f,l({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,l=new Array(s);l[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var c=2;c<s;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294),r=a(6010);const s="tabItem_Ymn6";function l(e){let{children:t,hidden:a,className:l}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(s,l),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>P});var n=a(7462),r=a(7294),s=a(6010),l=a(2466),o=a(6775),i=a(1980),c=a(7392),u=a(12);function p(e){return function(e){var t;return(null==(t=r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function d(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const n=(0,o.k6)(),s=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,i._X)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})}),[s,n])]}function g(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,s=d(e),[l,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s}))),[i,c]=f({queryString:a,groupId:n}),[p,g]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,s]=(0,u.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&s.set(e)}),[a,s])]}({groupId:n}),h=(()=>{const e=i??p;return m({value:e,tabValues:s})?e:null})();(0,r.useLayoutEffect)((()=>{h&&o(h)}),[h]);return{selectedValue:l,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),c(e),g(e)}),[c,g,s]),tabValues:s}}var h=a(2389);const y="tabList__CuJ",w="tabItem_LNqP";function v(e){let{className:t,block:a,selectedValue:o,selectValue:i,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,l.o5)(),d=e=>{const t=e.currentTarget,a=u.indexOf(t),n=c[a].value;n!==o&&(p(t),i(n))},m=e=>{var t;let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;a=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;a=u[t]??u[u.length-1];break}}null==(t=a)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":a},t)},c.map((e=>{let{value:t,label:a,attributes:l}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:d},l,{className:(0,s.Z)("tabs__item",w,null==l?void 0:l.className,{"tabs__item--active":o===t})}),a??t)})))}function k(e){let{lazy:t,children:a,selectedValue:n}=e;const s=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function b(e){const t=g(e);return r.createElement("div",{className:(0,s.Z)("tabs-container",y)},r.createElement(v,(0,n.Z)({},e,t)),r.createElement(k,(0,n.Z)({},e,t)))}function P(e){const t=(0,h.Z)();return r.createElement(b,(0,n.Z)({key:String(t)},e))}},9997:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var n=a(7462),r=(a(7294),a(3905)),s=a(4866),l=a(5162);const o={sidebar_label:"Upgrade LSP6 Key Manager",sidebar_position:4,describtion:"This guide explains how to change or upgrade the LSP6 Key Manager of a Universal Profile."},i="Upgrade the LSP6 Key Manager",c={unversionedId:"guides/key-manager/upgrade-lsp6",id:"guides/key-manager/upgrade-lsp6",title:"Upgrade the LSP6 Key Manager",description:"You will need a Universal Profile that you can control via its KeyManager to follow this guide.",source:"@site/docs/guides/key-manager/upgrade-lsp6.md",sourceDirName:"guides/key-manager",slug:"/guides/key-manager/upgrade-lsp6",permalink:"/guides/key-manager/upgrade-lsp6",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/key-manager/upgrade-lsp6.md",tags:[],version:"current",lastUpdatedAt:1681475070,formattedLastUpdatedAt:"Apr 14, 2023",sidebarPosition:4,frontMatter:{sidebar_label:"Upgrade LSP6 Key Manager",sidebar_position:4,describtion:"This guide explains how to change or upgrade the LSP6 Key Manager of a Universal Profile."},sidebar:"guidesSidebar",previous:{title:"Execute Relay Transactions",permalink:"/guides/key-manager/execute-relay-transactions"},next:{title:"Set the default implementation",permalink:"/guides/universal-receiver-delegate/set-default-implementation"}},u={},p=[{value:"Setup",id:"setup",level:2},{value:"Step 1 - Set up the constants and imports",id:"step-1---set-up-the-constants-and-imports",level:2},{value:"Step 2 - Initialize the controller account",id:"step-2---initialize-the-controller-account",level:2},{value:"Step 3 - Initialize UP contract",id:"step-3---initialize-up-contract",level:2},{value:"Step 4 - Deploy the new LSP6 Key Manager",id:"step-4---deploy-the-new-lsp6-key-manager",level:2},{value:"Step 5 - Upgrade your Key Manager",id:"step-5---upgrade-your-key-manager",level:2},{value:"Step 5.1 - Transfer Ownership to your new Key Manager",id:"step-51---transfer-ownership-to-your-new-key-manager",level:3},{value:"Step 5.2 - Accept Ownership from your new Key Manager",id:"step-52---accept-ownership-from-your-new-key-manager",level:3},{value:"Final code",id:"final-code",level:2},{value:"Test the new LSP6 Key Manager",id:"test-the-new-lsp6-key-manager",level:2}],d={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upgrade-the-lsp6-key-manager"},"Upgrade the LSP6 Key Manager"),(0,r.kt)("admonition",{title:"Requirements",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You will need a Universal Profile that you can control via its ",(0,r.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp6-key-manager"},"KeyManager")," to follow this guide.\nIf you don't have a Universal Profile yet, follow our previous guide ",(0,r.kt)("a",{parentName:"p",href:"/guides/universal-profile/create-profile"},(0,r.kt)("strong",{parentName:"a"},"Create a Universal Profile"))," or look at the ",(0,r.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/universal-profile"},(0,r.kt)("em",{parentName:"a"},"lsp-factory.js"))," docs.")),(0,r.kt)("p",null,"In this guide, we will learn how to upgrade the LSP6 Key Manager of your Universal Profile to the latest version available."),(0,r.kt)("p",null,"By the end of this guide, you will know how to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Deploy a new LSP6 Key Manager with the last updates."),(0,r.kt)("li",{parentName:"ul"},"Upgrade your Key Manager by changing the owner of your UP from your old to your new Key Manager.")),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"Make sure you have the following dependencies installed before beginning this tutorial:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Either ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/web3/web3.js"},(0,r.kt)("inlineCode",{parentName:"a"},"web3.js"))," or ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ethers-io/ethers.js/"},(0,r.kt)("inlineCode",{parentName:"a"},"ethers.js"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-smart-contracts/"},(0,r.kt)("inlineCode",{parentName:"a"},"@lukso/lsp-smart-contracts")))),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install web3 @lukso/lsp-smart-contracts\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install ethers @lukso/lsp-smart-contracts\n")))),(0,r.kt)("h2",{id:"step-1---set-up-the-constants-and-imports"},"Step 1 - Set up the constants and imports"),(0,r.kt)("p",null,"Create a JavaScript file and add the following imports on the top of the file:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"privateKey"),": private key of a controller address, ",(0,r.kt)("strong",{parentName:"li"},"MUST")," have ",(0,r.kt)("a",{parentName:"li",href:"/standards/universal-profile/lsp6-key-manager#permissions"},(0,r.kt)("strong",{parentName:"a"},"CHANGEOWNER"))," permission."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"universalProfileAddress"),": address of your Universal Profile.")),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Imports & Constants"',title:'"Imports',"&":!0,'Constants"':!0},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\nimport Web3 from 'web3';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\n\nconst privateKey = '0x...';\nconst universalProfileAddress = '0x...';\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Imports & Constants"',title:'"Imports',"&":!0,'Constants"':!0},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\nimport { ethers } from 'ethers';\n\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\n\nconst privateKey = '0x...';\nconst universalProfileAddress = '0x...';\n")))),(0,r.kt)("h2",{id:"step-2---initialize-the-controller-account"},"Step 2 - Initialize the controller account"),(0,r.kt)("p",null,"In order to send any transaction on the blockchain you need an EOA. In our case that account MUST have ",(0,r.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp6-key-manager#permissions"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"CHANGEOWNER")))," permission on the Universal Profile that will have its LSP6 Key Manager upgraded."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Initialise EOA"',title:'"Initialise','EOA"':!0},"const account = web3.eth.accounts.wallet.add(privateKey);\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Initialise EOA"',title:'"Initialise','EOA"':!0},"const account = new ethers.Wallet(privateKey).connect(provider);\n")))),(0,r.kt)("h2",{id:"step-3---initialize-up-contract"},"Step 3 - Initialize UP contract"),(0,r.kt)("p",null,"In order to transfer ownership of your Universal Profile, you need to initialize the UP's contract."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Create an instance of the old Key Manager"',title:'"Create',an:!0,instance:!0,of:!0,the:!0,old:!0,Key:!0,'Manager"':!0},"const universalProfile = new web3.eth.Contract(UniversalProfile.abi, universalProfileAddress);\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Create an instance of the old Key Manager"',title:'"Create',an:!0,instance:!0,of:!0,the:!0,old:!0,Key:!0,'Manager"':!0},"const universalProfile = new ethers.Contract(universalProfileAddress, UniversalProfile.abi);\n")))),(0,r.kt)("h2",{id:"step-4---deploy-the-new-lsp6-key-manager"},"Step 4 - Deploy the new LSP6 Key Manager"),(0,r.kt)("p",null,"Deploy a new LSP6 Key Manager with the latest updates."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Deploy a new Key Manager"',title:'"Deploy',a:!0,new:!0,Key:!0,'Manager"':!0},"const newKeyManager = new web3.eth.Contract(LSP6KeyManager.abi);\nawait newKeyManager\n  .deploy({\n    data: LSP6KeyManager.bytecode,\n    arguments: [universalProfileAddress],\n  })\n  .send({\n    from: account.address,\n    gas: 3_000_000,\n    gasPrice: '1000000000',\n  });\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Deploy a new Key Manager"',title:'"Deploy',a:!0,new:!0,Key:!0,'Manager"':!0},"const keyManagerFactory = new ethers.ContractFactory(\n  LSP6KeyManager.abi,\n  LSP6KeyManager.bytecode,\n);\nconst newKeyManager = await keyManagerFactory.deploy(universalProfileAddress);\n")))),(0,r.kt)("h2",{id:"step-5---upgrade-your-key-manager"},"Step 5 - Upgrade your Key Manager"),(0,r.kt)("h3",{id:"step-51---transfer-ownership-to-your-new-key-manager"},"Step 5.1 - Transfer Ownership to your new Key Manager"),(0,r.kt)("p",null,"Create a calldata for the ",(0,r.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp14-ownable-2-step#transferownership"},(0,r.kt)("inlineCode",{parentName:"a"},"transferOwnership(address)"))," function and shift the ownership of your Universal Profile from your current LSP6 Key Manager."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Transfer ownership of the Universal Profile from the old Key Manager to the new one"',title:'"Transfer',ownership:!0,of:!0,the:!0,Universal:!0,Profile:!0,from:!0,old:!0,Key:!0,Manager:!0,to:!0,new:!0,'one"':!0},"await universalProfile.methods.transferOwnership(newKeyManager.address).send({\n  from: account.address,\n  gas: 1_000_000,\n  gasPrice: '1000000000',\n});\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Transfer ownership of the Universal Profile from the old Key Manager to the new one"',title:'"Transfer',ownership:!0,of:!0,the:!0,Universal:!0,Profile:!0,from:!0,old:!0,Key:!0,Manager:!0,to:!0,new:!0,'one"':!0},"await universalProfile\n  .connect(account)\n  .transferOwnership(newKeyManager.address);\n")))),(0,r.kt)("h3",{id:"step-52---accept-ownership-from-your-new-key-manager"},"Step 5.2 - Accept Ownership from your new Key Manager"),(0,r.kt)("p",null,"Create a calldata for the ",(0,r.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp14-ownable-2-step#acceptownership"},(0,r.kt)("inlineCode",{parentName:"a"},"claimOwnership()"))," function and take the ownership of your Universal Profile from your new LSP6 Key Manager."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Accept ownership of the Universal Profile via the new Key Manager"',title:'"Accept',ownership:!0,of:!0,the:!0,Universal:!0,Profile:!0,via:!0,new:!0,Key:!0,'Manager"':!0},"const acceptOwnershipCalldata = new web3.eth.Contract(UniversalProfile.abi).methods.acceptOwnership().encodeABI();\n\nawait newKeyManager.methods['execute(bytes)'](acceptOwnershipCalldata).send({\n  from: account.address,\n  gas: 1_000_000,\n  gasPrice: '1000000000',\n});\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Accept ownership of the Universal Profile via the new Key Manager"',title:'"Accept',ownership:!0,of:!0,the:!0,Universal:!0,Profile:!0,via:!0,new:!0,Key:!0,'Manager"':!0},"const acceptOwnershipCalldata = new ethers.Interface(UniversalProfile.abi).encodeFunctionData(\"acceptOwnership()\");\n\nawait newKeyManager.connect(account)['execute(bytes)'](acceptOwnershipCalldata);\n")))),(0,r.kt)("admonition",{title:"\ud83e\udd73",type:"success"},(0,r.kt)("p",{parentName:"admonition"},"The upgrade has been completed successfully.")),(0,r.kt)("h2",{id:"final-code"},"Final code"),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="upgrade-lsp6.js"',title:'"upgrade-lsp6.js"'},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\nimport Web3 from 'web3';\nconst web3 = new Web3('https://rpc.l16.lukso.network');\n\nconst privateKey = '0x...';\nconst universalProfileAddress = '0x...';\nconst keyManagerAddress = '0x...';\n\nconst upgradeLSP6 = async () => {\n  // Initialize the controller account\n  const account = web3.eth.accounts.wallet.add(privateKey);\n\n  // Initialize your current UP\n  const universalProfile = new web3.eth.Contract(UniversalProfile.abi, universalProfileAddress);\n\n  // Deploy a new LSP6 Key Manager\n  const newKeyManager = new web3.eth.Contract(LSP6KeyManager.abi);\n  await newKeyManager.deploy({\n    data: LSP6KeyManager.bytecode,\n    arguments: [universalProfileAddress],\n  }).send({\n    from: account.address,\n    gas: 3_000_000,\n    gasPrice: '1000000000',\n  });\n\n  // Transfer the ownership of your Universal Profile from the current LSP6 Key Manager to a new LSP6 Key Manager\n  await universalProfile.methods.transferOwnership(newKeyManager.address).send({\n    from: account.address,\n    gas: 1_000_000,\n    gasPrice: '1000000000',\n  });\n\n  // Accept the ownership of your Universal Profile from the new LSP6 Key Manager\n  const acceptOwnershipCalldata = new web3.eth.Contract(UniversalProfile.abi).methods.acceptOwnership().encodeABI();\n\n  await newKeyManager.methods['execute(bytes)'](acceptOwnershipCalldata).send({\n    from: account.address,\n    gas: 1_000_000,\n    gasPrice: '1000000000',\n  });\n};\n\nawait upgradeLSP6();\n"))),(0,r.kt)(l.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="upgrade-lsp6.js"',title:'"upgrade-lsp6.js"'},"import UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\nimport { ethers } from 'ethers';\n\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\n\nconst privateKey = '0x...';\nconst universalProfileAddress = '0x...';\nconst keyManagerAddress = '0x...';\n\nconst upgradeLSP6 = async () => {\n  // Initialize the controller account\n  const account = new ethers.Wallet(privateKey).connect(provider);\n\n  // Initialize your current UP\n  const universalProfile = new ethers.Contract(universalProfileAddress, UniversalProfile.abi);\n\n  // Deploy a new LSP6 Key Manager\n  const keyManagerFactory = new ethers.ContractFactory(\n    LSP6KeyManager.abi,\n    LSP6KeyManager.bytecode,\n  );\n  const newKeyManager = await keyManagerFactory.deploy(universalProfileAddress);\n\n  // Transfer the ownership of your Universal Profile from the current LSP6 Key Manager to a new LSP6 Key Manager\n  await universalProfile\n    .connect(account)\n    .transferOwnership(newKeyManager.address);\n\n  // Accept the ownership of your Universal Profile from the new LSP6 Key Manager\n  const acceptOwnershipCalldata = new ethers.Interface(UniversalProfile.abi).encodeFunctionData(\"acceptOwnership()\");\n\n  await newKeyManager.connect(account)['execute(bytes)'](acceptOwnershipCalldata);\n};\n\nawait upgradeLSP6();\n")))),(0,r.kt)("h2",{id:"test-the-new-lsp6-key-manager"},"Test the new LSP6 Key Manager"),(0,r.kt)("p",null,"We can now check the owner of the Universal Profile. If everything went through, the owner should be the address of the new LSP6 Key Manager.\nCreate the following file with the name ",(0,r.kt)("inlineCode",{parentName:"p"},"test-new-lsp6.js")," and run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"node test-new-lsp6.js\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="test-new-lsp6.js"',title:'"test-new-lsp6.js"'},"import LSP0ERC725YAccount from '@lukso/lsp-smart-contracts/artifacts/LSP0ERC725YAccount.json';\nimport LSP6KeyManager from '@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json';\nimport Web3 from 'web3';\n\nconst web3 = new Web3('https://rpc.l16.lukso.network');\n\nconst universalProfileAddress = '0x...';\nconst keyManagerAddress = '0x...';\n\nconst testLSP6 = async () => {\n  const universalProfile = new web3.eth.Contract(LSP0ERC725YAccount.abi, universalProfileAddress);\n\n  const universalProfileOwner = await universalProfile.methods.owner().call();\n\n  console.log(`The new owner of the Universal Profile is: ${universalProfileOwner}`);\n  console.log(`The old LSP6 Key Manager is at address: ${keyManagerAdderss}`);\n\n  const keyManager = new web3.eth.Contract(LSP6KeyManager.abi, universalProfileOwner);\n\n  const keyManagerTarget = await keyManager.methods.target().call();\n\n  console.log(`The address of the Universal Profile is: ${universalProfile._address}`);\n  console.log(`The target of the new LSP6 Key Manager: ${keyManagerTarget}`);\n};\n\nawait testLSP6();\n")))}m.isMDXComponent=!0}}]);