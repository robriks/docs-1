"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[3736],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var s=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=s.createContext({}),d=function(e){var t=s.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return s.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},p=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,v=p["".concat(o,".").concat(m)]||p[m]||u[m]||a;return n?s.createElement(v,i(i({ref:t},c),{},{components:n})):s.createElement(v,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=p;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=n[d];return s.createElement.apply(null,i)}return s.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(7294),r=n(6010);const a="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return s.createElement("div",{role:"tabpanel",className:(0,r.Z)(a,i),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>D});var s=n(7462),r=n(7294),a=n(6010),i=n(2466),l=n(6775),o=n(1980),d=n(7392),c=n(12);function u(e){return function(e){var t;return(null==(t=r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:s,default:r}}=e;return{value:t,label:n,attributes:s,default:r}}))}function p(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??u(n);return function(e){const t=(0,d.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function v(e){let{queryString:t=!1,groupId:n}=e;const s=(0,l.k6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o._X)(a),(0,r.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(s.location.search);t.set(a,e),s.replace({...s.location,search:t.toString()})}),[a,s])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,a=p(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[o,d]=v({queryString:n,groupId:s}),[u,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,a]=(0,c.Nk)(n);return[s,(0,r.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:s}),h=(()=>{const e=o??u;return m({value:e,tabValues:a})?e:null})();(0,r.useLayoutEffect)((()=>{h&&l(h)}),[h]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),f(e)}),[d,f,a]),tabValues:a}}var h=n(2389);const P="tabList__CuJ",y="tabItem_LNqP";function g(e){let{className:t,block:n,selectedValue:l,selectValue:o,tabValues:d}=e;const c=[],{blockElementScrollPositionUntilNextRender:u}=(0,i.o5)(),p=e=>{const t=e.currentTarget,n=c.indexOf(t),s=d[n].value;s!==l&&(u(t),o(s))},m=e=>{var t;let n=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},t)},d.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,s.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:p},i,{className:(0,a.Z)("tabs__item",y,null==i?void 0:i.className,{"tabs__item--active":l===t})}),n??t)})))}function U(e){let{lazy:t,children:n,selectedValue:s}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==s}))))}function b(e){const t=f(e);return r.createElement("div",{className:(0,a.Z)("tabs-container",P)},r.createElement(g,(0,s.Z)({},e,t)),r.createElement(U,(0,s.Z)({},e,t)))}function D(e){const t=(0,h.Z)();return r.createElement(b,(0,s.Z)({key:String(t)},e))}},4837:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>d,toc:()=>u});var s=n(7462),r=(n(7294),n(3905)),a=n(4866),i=n(5162);const l={sidebar_label:"Set the default implementation",sidebar_position:1},o="Set the default implementation",d={unversionedId:"guides/universal-receiver-delegate/set-default-implementation",id:"guides/universal-receiver-delegate/set-default-implementation",title:"Set the default implementation",description:"Users deploying their Universal Profiles using the guides that utilize lsp-factory or the Browser Extension can skip this guide, as this contract is already deployed and set for their profiles.",source:"@site/docs/guides/universal-receiver-delegate/set-default-implementation.md",sourceDirName:"guides/universal-receiver-delegate",slug:"/guides/universal-receiver-delegate/set-default-implementation",permalink:"/guides/universal-receiver-delegate/set-default-implementation",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/universal-receiver-delegate/set-default-implementation.md",tags:[],version:"current",lastUpdatedAt:1681477589,formattedLastUpdatedAt:"Apr 14, 2023",sidebarPosition:1,frontMatter:{sidebar_label:"Set the default implementation",sidebar_position:1},sidebar:"guidesSidebar",previous:{title:"Upgrade LSP6 Key Manager",permalink:"/guides/key-manager/upgrade-lsp6"},next:{title:"Accept & Reject Assets",permalink:"/guides/universal-receiver-delegate/accept-reject-assets"}},c={},u=[{value:"Setup",id:"setup",level:2},{value:"Step 1 - Imports, constants and EOA",id:"step-1---imports-constants-and-eoa",level:2},{value:"Step 2 - Deploy the default Universal Receiver Delegate contract",id:"step-2---deploy-the-default-universal-receiver-delegate-contract",level:2},{value:"Create a contract instance",id:"create-a-contract-instance",level:3},{value:"Send the contract deployment transaction",id:"send-the-contract-deployment-transaction",level:3},{value:"Final code",id:"final-code",level:3},{value:"Step 3 - Set the address of the URD in the storage",id:"step-3---set-the-address-of-the-urd-in-the-storage",level:2},{value:"Create an UP contract instance",id:"create-an-up-contract-instance",level:3},{value:"Register URD on the UP + set the URD permissions",id:"register-urd-on-the-up--set-the-urd-permissions",level:3},{value:"Set the URD and its permissions",id:"set-the-urd-and-its-permissions",level:3},{value:"Final code",id:"final-code-1",level:3},{value:"Final code - Deploy &amp; Update",id:"final-code---deploy--update",level:2}],p={toc:u};function m(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,s.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"set-the-default-implementation"},"Set the default implementation"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Users deploying their Universal Profiles using the guides that utilize ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/guides/universal-profile/create-profile"},"lsp-factory"))," or the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/guides/browser-extension/create-a-universal-profile"},"Browser Extension"))," can skip this guide, as this contract is already deployed and set for their profiles.")),(0,r.kt)("p",null,"This guide will teach you how to deploy and set the default implementation of the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/lsp1-universal-receiver-delegate-up"},"Universal Receiver Delegate"))," (URD) used by the Universal Profile. This contract will register the addresses of the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/universal-profile/lsp5-received-assets"},"received assets"))," and ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/universal-profile/lsp10-received-vaults"},"vaults"))," and will remove them on a balance equal to 0. This contract requires the ",(0,r.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp6-key-manager#super-permissions"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"SUPER_SETDATA")," Permission"))," to interact with the profile through the KeyManager."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"UniversalReceiverDelegate setting data keys on profile",src:n(1704).Z,width:"4938",height:"3239"})),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"Make sure you have the following dependencies installed before beginning this tutorial:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Either ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/web3/web3.js"},(0,r.kt)("inlineCode",{parentName:"a"},"web3.js"))," or ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ethers-io/ethers.js/"},(0,r.kt)("inlineCode",{parentName:"a"},"ethers.js"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-smart-contracts/"},(0,r.kt)("inlineCode",{parentName:"a"},"@lukso/lsp-smart-contracts")))),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install web3 @lukso/lsp-smart-contracts\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Install the dependencies"',title:'"Install',the:!0,'dependencies"':!0},"npm install ethers @lukso/lsp-smart-contracts\n")))),(0,r.kt)("h2",{id:"step-1---imports-constants-and-eoa"},"Step 1 - Imports, constants and EOA"),(0,r.kt)("p",null,"For beginners we need to get the ",(0,r.kt)("em",{parentName:"p"},"ABIs")," of the contracts that we will use and the ",(0,r.kt)("em",{parentName:"p"},"bytecode")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"LSP1UniversalReceiverDelegateUP"),".",(0,r.kt)("br",{parentName:"p"}),"\n","After that we need to store the address of our Universal Profile.",(0,r.kt)("br",{parentName:"p"}),"\n","Then we will initialize the EOA that we will further use."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Imports, Constants & EOA"',title:'"Imports,',Constants:!0,"&":!0,'EOA"':!0},"import LSP1UniversalReceiverDelegateUP from '@lukso/lsp-smart-contracts/artifacts/LSP1UniversalReceiverDelegateUP.json';\nimport UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport {\n  ERC725YDataKeys,\n  PERMISSIONS,\n} from '@lukso/lsp-smart-contracts/constants.js';\nimport Web3 from 'web3';\n\n// constants\nconst web3 = new Web3('https://rpc.l16.lukso.network');\nconst URD_DATA_KEY = ERC725YDataKeys.LSP1.LSP1UniversalReceiverDelegate;\nconst universalProfileAddress = '0x...';\n\n// setup your EOA\nconst privateKey = '0x...';\nconst EOA = web3.eth.accounts.wallet.add(privateKey);\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Imports, Constants & EOA"',title:'"Imports,',Constants:!0,"&":!0,'EOA"':!0},"import LSP1UniversalReceiverDelegateUP from '@lukso/lsp-smart-contracts/artifacts/LSP1UniversalReceiverDelegateUP.json';\nimport UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport {\n  ERC725YDataKeys,\n  PERMISSIONS,\n} from '@lukso/lsp-smart-contracts/constants.js';\nimport { ethers } from 'ethers';\n\n// constants\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\nconst URD_DATA_KEY = ERC725YDataKeys.LSP1.LSP1UniversalReceiverDelegate;\nconst universalProfileAddress = '0x...';\n\n// setup your EOA\nconst privateKey = '0x...'; // your EOA private key (controller address)\nconst EOA = new ethers.Wallet(privateKey).connect(provider);\n")))),(0,r.kt)("h2",{id:"step-2---deploy-the-default-universal-receiver-delegate-contract"},"Step 2 - Deploy the default Universal Receiver Delegate contract"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("strong",{parentName:"p"},"Universal Profile")," and the ",(0,r.kt)("strong",{parentName:"p"},"Vault")," don't use the same implementation of the Universal Receiver Delegate.")),(0,r.kt)("h3",{id:"create-a-contract-instance"},"Create a contract instance"),(0,r.kt)("p",null,"At this step we will create an instance of the Universal profile URD that we will further be used to deploy one."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Contract instance of the Universal Profile URD"',title:'"Contract',instance:!0,of:!0,the:!0,Universal:!0,Profile:!0,'URD"':!0},"// create an instance of the LSP1UniversalReceiverDelegateUP\nlet universalProfileURD = new web3.eth.Contract(\n  LSP1UniversalReceiverDelegateUP.abi,\n);\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Contract instance of the Universal Profile URD"',title:'"Contract',instance:!0,of:!0,the:!0,Universal:!0,Profile:!0,'URD"':!0},"// create a LSP1UniversalReceiverDelegateUP Contract Factory\nlet universalProfileURDFactory = new ethers.ContractFactory(\n  LSP1UniversalReceiverDelegateUP.abi,\n  LSP1UniversalReceiverDelegateUP.bytecode,\n);\n")))),(0,r.kt)("h3",{id:"send-the-contract-deployment-transaction"},"Send the contract deployment transaction"),(0,r.kt)("p",null,"Send the deployment transaction to get a newly deployed URD."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Send the transaction for deploying a new Universal Profile URD"',title:'"Send',the:!0,transaction:!0,for:!0,deploying:!0,a:!0,new:!0,Universal:!0,Profile:!0,'URD"':!0},"// deploy the Universal Receiver Delegate UP contract\nawait universalProfileURD\n  .deploy({\n    data: LSP1UniversalReceiverDelegateUP.bytecode,\n  })\n  .send({\n    from: EOA.address,\n    gas: 5_000_000,\n    gasPrice: '1000000000',\n  });\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Send the transaction for deploying a new Universal Profile URD"',title:'"Send',the:!0,transaction:!0,for:!0,deploying:!0,a:!0,new:!0,Universal:!0,Profile:!0,'URD"':!0},"// deploy the Universal Receiver Delegate UP contract\nconst universalProfileURD = await universalProfileURDFactory\n  .connect(EOA)\n  .deploy();\n")))),(0,r.kt)("h3",{id:"final-code"},"Final code"),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Deploy a Universal Receiver Delegate for the Universal Profile"',title:'"Deploy',a:!0,Universal:!0,Receiver:!0,Delegate:!0,for:!0,the:!0,'Profile"':!0},"const deployUniversalProfileURD = async () => {\n  // create an instance of the LSP1UniversalReceiverDelegateUP\n  let universalProfileURD = new web3.eth.Contract(\n    LSP1UniversalReceiverDelegateUP.abi,\n  );\n\n  // deploy the Universal Receiver Delegate UP contract\n  const universalProfileURDAddress = await universalProfileURD\n    .deploy({\n      data: LSP1UniversalReceiverDelegateUP.bytecode,\n    })\n    .send({\n      from: EOA.address,\n      gas: 5_000_000,\n      gasPrice: '1000000000',\n    })\n    .on('receipt', (receipt) => {\n      return receipt.contractAddress;\n    });\n\n  return universalProfileURDAddress;\n};\n\n// deploy a new Universal Profile URD and retrieve its address\nconst universalProfileURDAddress = await deployUniversalProfileURD();\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Deploy a Universal Receiver Delegate for the Universal Profile"',title:'"Deploy',a:!0,Universal:!0,Receiver:!0,Delegate:!0,for:!0,the:!0,'Profile"':!0},"const deployUniversalProfileURD = async () => {\n  // create a LSP1UniversalReceiverDelegateUP Contract Factory\n  let universalProfileURDFactory = new ethers.ContractFactory(\n    LSP1UniversalReceiverDelegateUP.abi,\n    LSP1UniversalReceiverDelegateUP.bytecode,\n  );\n\n  // deploy the Universal Receiver Delegate UP contract\n  const universalProfileURD = await universalProfileURDFactory\n    .connect(EOA)\n    .deploy();\n\n  return universalProfileURD.target;\n};\n\n// deploy a new Universal Profile URD and retrieve its address\nconst universalProfileURDAddress = await deployUniversalProfileURD();\n")))),(0,r.kt)("h2",{id:"step-3---set-the-address-of-the-urd-in-the-storage"},"Step 3 - Set the address of the URD in the storage"),(0,r.kt)("p",null,"After deploying the contract, we need to set its address under the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/generic-standards/lsp1-universal-receiver#extension"},"LSP1-UniversalReceiverDelegate Data Key"))," and grant it the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/universal-profile/lsp6-key-manager#super-permissions"},"SUPER_SETDATA"))," permission."),(0,r.kt)("h3",{id:"create-an-up-contract-instance"},"Create an UP contract instance"),(0,r.kt)("p",null,"Firstly we need to create an instance for the ",(0,r.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp0-erc725account"},(0,r.kt)("strong",{parentName:"a"},"Universal Profile"))," contract."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Contract instance for the Universal Profile"',title:'"Contract',instance:!0,for:!0,the:!0,Universal:!0,'Profile"':!0},"// create an instance of the Universal Profile\nconst universalProfile = new web3.eth.Contract(\n  UniversalProfile.abi,\n  universalProfileAddress,\n);\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Contract instance for the Universal Profile"',title:'"Contract',instance:!0,for:!0,the:!0,Universal:!0,'Profile"':!0},"// create an instance of the Universal Profile\nconst universalProfile = new ethers.Contract(\n  universalProfileAddress,\n  UniversalProfile.abi,\n);\n")))),(0,r.kt)("h3",{id:"register-urd-on-the-up--set-the-urd-permissions"},"Register URD on the UP + set the URD permissions"),(0,r.kt)("p",null,"Generate ",(0,r.kt)("em",{parentName:"p"},"Data Keys & Values")," for ",(0,r.kt)("a",{parentName:"p",href:"/standards/generic-standards/lsp1-universal-receiver-delegate/#how-delegation-works"},(0,r.kt)("strong",{parentName:"a"},"adding a URD"))," to the Universal Profile and for granting ",(0,r.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp6-key-manager#super-permissions"},(0,r.kt)("strong",{parentName:"a"},"SUPER_SETDATA"))," permission to the ",(0,r.kt)("strong",{parentName:"p"},"URD"),"."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Encode Data Keys & Values for updating the URD and its permissions"',title:'"Encode',Data:!0,Keys:!0,"&":!0,Values:!0,for:!0,updating:!0,the:!0,URD:!0,and:!0,its:!0,'permissions"':!0},"const addressPermissionsOldArrayLengthHex = await myUP.methods[\n  'getData(bytes32)'\n](ERC725YDataKeys.LSP6['AddressPermissions[]'].length).call();\n\nconst addressPermissionsNewArrayLength =\n  web3.utils.hexToNumber(addressPermissionsOldArrayLengthHex) + 1;\n\nconst addressPermissionsNewArrayLengthHex = web3.utils.padLeft(\n  web3.utils.numberToHex(addressPermissionsNewArrayLength),\n  64,\n);\n\n// bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\nconst newElementIndexInArrayHex = addressPermissionsOldArrayLengthHex.substring(\n  34,\n  66,\n);\n\nconst dataKeys = [\n  URD_DATA_KEY,\n  ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n  ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n    newElementIndexInArrayHex,\n  ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n    universalProfileURDAddress.substring(2),\n];\nconst dataValues = [\n  universalProfileURDAddress,\n  addressPermissionsNewArrayLengthHex,\n  universalProfileURDAddress,\n  PERMISSIONS.SUPER_SETDATA,\n];\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Encode Data Keys & Values for updating the URD and its permissions"',title:'"Encode',Data:!0,Keys:!0,"&":!0,Values:!0,for:!0,updating:!0,the:!0,URD:!0,and:!0,its:!0,'permissions"':!0},"const addressPermissionsOldArrayLengthHex = await myUP['getData(bytes32)'](\n  ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n);\n\nconst addressPermissionsNewArrayLength =\n  ethers.toNumber(addressPermissionsOldArrayLengthHex) + 1;\n\nconst addressPermissionsNewArrayLengthHex =\n  '0x' + addressPermissionsNewArrayLength2.toString(16).padStart(64, '0');\n\n// bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\nconst newElementIndexInArrayHex = addressPermissionsOldArrayLengthHex.substring(\n  34,\n  66,\n);\n\nconst dataKeys = [\n  URD_DATA_KEY,\n  ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n  ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n    newElementIndexInArrayHex,\n  ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n    universalProfileURDAddress.substring(2),\n];\nconst dataValues = [\n  universalProfileURDAddress,\n  addressPermissionsNewArrayLengthHex,\n  universalProfileURDAddress,\n  PERMISSIONS.SUPER_SETDATA,\n];\n")))),(0,r.kt)("h3",{id:"set-the-urd-and-its-permissions"},"Set the URD and its permissions"),(0,r.kt)("p",null,"Lastly, we need to send the transaction that will update the URD and its permissions on the Universal Profile."),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Update the data on the Universal Profile"',title:'"Update',the:!0,data:!0,on:!0,Universal:!0,'Profile"':!0},"// update the Universal Profile data\nawait universalProfile.methods['setData(bytes32[],bytes[])'](\n  dataKeys,\n  dataValues,\n).send({\n  from: EOA.address,\n  gasLimit: 600_000,\n});\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Update the data on the Universal Profile"',title:'"Update',the:!0,data:!0,on:!0,Universal:!0,'Profile"':!0},"// update the Universal Profile data\nawait universalProfile\n  .connect(EOA)\n  ['setData(bytes32[],bytes[])'](dataKeys, dataValues);\n")))),(0,r.kt)("h3",{id:"final-code-1"},"Final code"),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Update the URD of the Universal Profile and its permissions"',title:'"Update',the:!0,URD:!0,of:!0,Universal:!0,Profile:!0,and:!0,its:!0,'permissions"':!0},"const updateUniversalProfileURD = async (vaultURDAddress) => {\n  // create an instance of the Universal Profile\n  const universalProfile = new web3.eth.Contract(\n    UniversalProfile.abi,\n    universalProfileAddress,\n  );\n\n  const addressPermissionsOldArrayLengthHex = await myUP.methods[\n    'getData(bytes32)'\n  ](ERC725YDataKeys.LSP6['AddressPermissions[]'].length).call();\n\n  const addressPermissionsNewArrayLength =\n    web3.utils.hexToNumber(addressPermissionsOldArrayLengthHex) + 1;\n\n  const addressPermissionsNewArrayLengthHex = web3.utils.padLeft(\n    web3.utils.numberToHex(addressPermissionsNewArrayLength),\n    64,\n  );\n\n  // bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\n  const newElementIndexInArrayHex =\n    addressPermissionsOldArrayLengthHex.substring(34, 66);\n\n  const dataKeys = [\n    URD_DATA_KEY,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n      newElementIndexInArrayHex,\n    ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n      universalProfileURDAddress.substring(2),\n  ];\n  const dataValues = [\n    universalProfileURDAddress,\n    addressPermissionsNewArrayLengthHex,\n    universalProfileURDAddress,\n    PERMISSIONS.SUPER_SETDATA,\n  ];\n\n  // update the Universal Profile data\n  await universalProfile.methods['setData(bytes32[],bytes[])'](\n    dataKeys,\n    dataValues,\n  ).send({\n    from: EOA.address,\n    gasLimit: 600_000,\n  });\n};\n\n// update the URD of the Universal profile\nawait updateUniversalProfileURD(vaultURDAddress);\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Update the URD of the Universal Profile and its permissions"',title:'"Update',the:!0,URD:!0,of:!0,Universal:!0,Profile:!0,and:!0,its:!0,'permissions"':!0},"const updateUniversalProfileURD = async (vaultURDAddress) => {\n  // create an instance of the Universal Profile\n  const universalProfile = new ethers.Contract(\n    universalProfileAddress,\n    UniversalProfile.abi,\n  );\n\n  const addressPermissionsOldArrayLengthHex = await myUP['getData(bytes32)'](\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n  );\n\n  const addressPermissionsNewArrayLength =\n    ethers.toNumber(addressPermissionsOldArrayLengthHex) + 1;\n\n  const addressPermissionsNewArrayLengthHex =\n    '0x' + addressPermissionsNewArrayLength2.toString(16).padStart(64, '0');\n\n  // bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\n  const newElementIndexInArrayHex =\n    addressPermissionsOldArrayLengthHex.substring(34, 66);\n\n  const dataKeys = [\n    URD_DATA_KEY,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n      newElementIndexInArrayHex,\n    ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n      universalProfileURDAddress.substring(2),\n  ];\n  const dataValues = [\n    universalProfileURDAddress,\n    addressPermissionsNewArrayLengthHex,\n    universalProfileURDAddress,\n    PERMISSIONS.SUPER_SETDATA,\n  ];\n\n  // update the Universal Profile data\n  await universalProfile\n    .connect(EOA)\n    ['setData(bytes32[],bytes[])'](dataKeys, dataValues);\n};\n\n// update the URD of the Universal profile\nawait updateUniversalProfileURD(vaultURDAddress);\n")))),(0,r.kt)("h2",{id:"final-code---deploy--update"},"Final code - Deploy & Update"),(0,r.kt)(a.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"web3js",label:"web3.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Deploy a Universal Profile URD, update its permissions and add it to the Universal Profile"',title:'"Deploy',a:!0,Universal:!0,Profile:!0,"URD,":!0,update:!0,its:!0,permissions:!0,and:!0,add:!0,it:!0,to:!0,the:!0,'Profile"':!0},"import LSP1UniversalReceiverDelegateUP from '@lukso/lsp-smart-contracts/artifacts/LSP1UniversalReceiverDelegateUP.json';\nimport UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport {\n  ERC725YDataKeys,\n  PERMISSIONS,\n} from '@lukso/lsp-smart-contracts/constants.js';\nimport Web3 from 'web3';\n\n// constants\nconst web3 = new Web3('https://rpc.l16.lukso.network');\nconst URD_DATA_KEY = ERC725YDataKeys.LSP1.LSP1UniversalReceiverDelegate;\nconst universalProfileAddress = '0x...';\n\n// setup your EOA\nconst privateKey = '0x...';\nconst EOA = web3.eth.accounts.wallet.add(privateKey);\n\nconst deployUniversalProfileURD = async () => {\n  // create an instance of the LSP1UniversalReceiverDelegateUP\n  let universalProfileURD = new web3.eth.Contract(\n    LSP1UniversalReceiverDelegateUP.abi,\n  );\n\n  // deploy the Universal Receiver Delegate UP contract\n  const universalProfileURDAddress = await universalProfileURD\n    .deploy({\n      data: LSP1UniversalReceiverDelegateUP.bytecode,\n    })\n    .send({\n      from: EOA.address,\n      gas: 5_000_000,\n      gasPrice: '1000000000',\n    })\n    .on('receipt', (receipt) => {\n      return receipt.contractAddress;\n    });\n\n  return universalProfileURDAddress;\n};\n\nconst updateUniversalProfileURD = async (vaultURDAddress) => {\n  // create an instance of the Universal Profile\n  const universalProfile = new web3.eth.Contract(\n    UniversalProfile.abi,\n    universalProfileAddress,\n  );\n\n  const addressPermissionsOldArrayLengthHex = await myUP.methods[\n    'getData(bytes32)'\n  ](ERC725YDataKeys.LSP6['AddressPermissions[]'].length).call();\n\n  const addressPermissionsNewArrayLength =\n    web3.utils.hexToNumber(addressPermissionsOldArrayLengthHex) + 1;\n\n  const addressPermissionsNewArrayLengthHex = web3.utils.padLeft(\n    web3.utils.numberToHex(addressPermissionsNewArrayLength),\n    64,\n  );\n\n  // bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\n  const newElementIndexInArrayHex =\n    addressPermissionsOldArrayLengthHex.substring(34, 66);\n\n  const dataKeys = [\n    URD_DATA_KEY,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n      newElementIndexInArrayHex,\n    ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n      universalProfileURDAddress.substring(2),\n  ];\n  const dataValues = [\n    universalProfileURDAddress,\n    addressPermissionsNewArrayLengthHex,\n    universalProfileURDAddress,\n    PERMISSIONS.SUPER_SETDATA,\n  ];\n\n  // update the Universal Profile data\n  await universalProfile.methods['setData(bytes32[],bytes[])'](\n    dataKeys,\n    dataValues,\n  ).send({\n    from: EOA.address,\n    gasLimit: 600_000,\n  });\n};\n\n// deploy a new Universal Profile URD and retrieve its address\nconst universalProfileURDAddress = await deployUniversalProfileURD();\n\n// update the URD of the Universal profile\nawait updateUniversalProfileURD(vaultURDAddress);\n"))),(0,r.kt)(i.Z,{value:"ethersjs",label:"ethers.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Deploy a Universal Profile URD, update its permissions and add it to the Universal Profile"',title:'"Deploy',a:!0,Universal:!0,Profile:!0,"URD,":!0,update:!0,its:!0,permissions:!0,and:!0,add:!0,it:!0,to:!0,the:!0,'Profile"':!0},"import LSP1UniversalReceiverDelegateUP from '@lukso/lsp-smart-contracts/artifacts/LSP1UniversalReceiverDelegateUP.json';\nimport UniversalProfile from '@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json';\nimport {\n  ERC725YDataKeys,\n  PERMISSIONS,\n} from '@lukso/lsp-smart-contracts/constants.js';\nimport { ethers } from 'ethers';\n\n// constants\nconst provider = new ethers.JsonRpcProvider('https://rpc.l16.lukso.network');\nconst URD_DATA_KEY = ERC725YDataKeys.LSP1.LSP1UniversalReceiverDelegate;\nconst universalProfileAddress = '0x...';\n\n// setup your EOA\nconst privateKey = '0x...'; // your EOA private key (controller address)\nconst EOA = new ethers.Wallet(privateKey).connect(provider);\n\nconst deployUniversalProfileURD = async () => {\n  // create a LSP1UniversalReceiverDelegateUP Contract Factory\n  let universalProfileURDFactory = new ethers.ContractFactory(\n    LSP1UniversalReceiverDelegateUP.abi,\n    LSP1UniversalReceiverDelegateUP.bytecode,\n  );\n\n  // deploy the Universal Receiver Delegate UP contract\n  const universalProfileURD = await universalProfileURDFactory\n    .connect(EOA)\n    .deploy();\n\n  return universalProfileURD.target;\n};\n\nconst updateUniversalProfileURD = async (vaultURDAddress) => {\n  // create an instance of the Universal Profile\n  const universalProfile = new ethers.Contract(\n    universalProfileAddress,\n    UniversalProfile.abi,\n  );\n\n  const addressPermissionsOldArrayLengthHex = await myUP['getData(bytes32)'](\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n  );\n\n  const addressPermissionsNewArrayLength =\n    ethers.toNumber(addressPermissionsOldArrayLengthHex) + 1;\n\n  const addressPermissionsNewArrayLengthHex =\n    '0x' + addressPermissionsNewArrayLength2.toString(16).padStart(64, '0');\n\n  // bytes16 index `addressPermissionsOldArrayLengthHex` will serve as index\n  const newElementIndexInArrayHex =\n    addressPermissionsOldArrayLengthHex.substring(34, 66);\n\n  const dataKeys = [\n    URD_DATA_KEY,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].length,\n    ERC725YDataKeys.LSP6['AddressPermissions[]'].index +\n      newElementIndexInArrayHex,\n    ERC725YDataKeys.LSP6['AddressPermissions:Permissions'] +\n      universalProfileURDAddress.substring(2),\n  ];\n  const dataValues = [\n    universalProfileURDAddress,\n    addressPermissionsNewArrayLengthHex,\n    universalProfileURDAddress,\n    PERMISSIONS.SUPER_SETDATA,\n  ];\n\n  // update the Universal Profile data\n  await universalProfile\n    .connect(EOA)\n    ['setData(bytes32[],bytes[])'](dataKeys, dataValues);\n};\n\n// deploy a new Universal Profile URD and retrieve its address\nconst universalProfileURDAddress = await deployUniversalProfileURD();\n\n// update the URD of the Universal profile\nawait updateUniversalProfileURD(vaultURDAddress);\n")))))}m.isMDXComponent=!0},1704:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/token-transfer-4-89539e6555aaf098a5b55d2b68b9fefe.jpg"}}]);